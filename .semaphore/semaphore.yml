---
version: v1.0
name: Benchmarking suite
execution_time_limit:
  hours: 3
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
- name: setup
  dependencies: []
  task:
    jobs:
    - name: setup
      commands:
      - checkout
      - cache store $SEMAPHORE_GIT_SHA .
      - sudo snap install crystal --classic
      - sudo apt-get -y install libyaml-dev libevent-dev
      - shards build --static
      - cache store bin bin
      - bundle config path .cache
      - bundle install
      - cache store built-in .cache
      - bundle exec rake config
- name: php
  dependencies:
  - setup
  task:
    prologue:
      commands:
      - cache restore $SEMAPHORE_GIT_SHA
      - cache restore bin
      - cache restore built-in
      - find bin -type f -exec chmod +x {} \;
      - bundle config path .cache
      - bundle install
      - bundle exec rake config
    env_vars:
    - name: CLEAN
      value: 'off'
    - name: COLLECT
      value: 'off'
    jobs:
    - name: slim-swoole
      commands:
      - cd php/slim-swoole && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/slim-swoole bundle exec rspec .spec
    - name: chubbyphp-swoole
      commands:
      - cd php/chubbyphp-swoole && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/chubbyphp-swoole bundle exec rspec .spec
    - name: sunrise-router-roadrunner
      commands:
      - cd php/sunrise-router-roadrunner && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/sunrise-router-roadrunner bundle exec rspec .spec
    - name: slim-roadrunner
      commands:
      - cd php/slim-roadrunner && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/slim-roadrunner bundle exec rspec .spec
    - name: swoft
      commands:
      - cd php/swoft && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/swoft bundle exec rspec .spec
    - name: simps
      commands:
      - cd php/simps && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/simps bundle exec rspec .spec
    - name: nano
      commands:
      - cd php/nano && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/nano bundle exec rspec .spec
    - name: codeigniter4
      commands:
      - cd php/codeigniter4 && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/codeigniter4 bundle exec rspec .spec
    - name: yii
      commands:
      - cd php/yii && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/yii bundle exec rspec .spec
    - name: phalcon
      commands:
      - cd php/phalcon && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/phalcon bundle exec rspec .spec
    - name: one-fpm
      commands:
      - cd php/one-fpm && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/one-fpm bundle exec rspec .spec
    - name: ice
      commands:
      - cd php/ice && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/ice bundle exec rspec .spec
    - name: spiral
      commands:
      - cd php/spiral && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/spiral bundle exec rspec .spec
    - name: mark
      commands:
      - cd php/mark && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/mark bundle exec rspec .spec
    - name: siler-swoole
      commands:
      - cd php/siler-swoole && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/siler-swoole bundle exec rspec .spec
    - name: workerman
      commands:
      - cd php/workerman && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/workerman bundle exec rspec .spec
    - name: chubbyphp-roadrunner
      commands:
      - cd php/chubbyphp-roadrunner && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/chubbyphp-roadrunner bundle exec rspec .spec
    - name: nette
      commands:
      - cd php/nette && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/nette bundle exec rspec .spec
    - name: sw-fw-less
      commands:
      - cd php/sw-fw-less && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/sw-fw-less bundle exec rspec .spec
    - name: laminas
      commands:
      - cd php/laminas && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/laminas bundle exec rspec .spec
    - name: chubbyphp
      commands:
      - cd php/chubbyphp && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/chubbyphp bundle exec rspec .spec
    - name: imi
      commands:
      - cd php/imi && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/imi bundle exec rspec .spec
    - name: basicphp
      commands:
      - cd php/basicphp && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/basicphp bundle exec rspec .spec
    - name: comet
      commands:
      - cd php/comet && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/comet bundle exec rspec .spec
    - name: sunrise-router
      commands:
      - cd php/sunrise-router && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/sunrise-router bundle exec rspec .spec
    - name: ubiquity
      commands:
      - cd php/ubiquity && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/ubiquity bundle exec rspec .spec
    - name: one
      commands:
      - cd php/one && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/one bundle exec rspec .spec
    - name: mezzio
      commands:
      - cd php/mezzio && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/mezzio bundle exec rspec .spec
    - name: lumen
      commands:
      - cd php/lumen && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/lumen bundle exec rspec .spec
    - name: siler
      commands:
      - cd php/siler && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/siler bundle exec rspec .spec
    - name: fastsitephp
      commands:
      - cd php/fastsitephp && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/fastsitephp bundle exec rspec .spec
    - name: bearframework
      commands:
      - cd php/bearframework && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/bearframework bundle exec rspec .spec
    - name: hamlet
      commands:
      - cd php/hamlet && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/hamlet bundle exec rspec .spec
    - name: symfony
      commands:
      - cd php/symfony && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/symfony bundle exec rspec .spec
    - name: slim
      commands:
      - cd php/slim && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/slim bundle exec rspec .spec
    - name: chubbyphp-workerman
      commands:
      - cd php/chubbyphp-workerman && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/chubbyphp-workerman bundle exec rspec .spec
    - name: sunrise-router-annotations
      commands:
      - cd php/sunrise-router-annotations && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/sunrise-router-annotations bundle exec rspec .spec
    - name: yii-swoole
      commands:
      - cd php/yii-swoole && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/yii-swoole bundle exec rspec .spec
    - name: laravel
      commands:
      - cd php/laravel && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/laravel bundle exec rspec .spec
    - name: hyperf
      commands:
      - cd php/hyperf && make build  -f .Makefile  && cd -
      - FRAMEWORK=php/hyperf bundle exec rspec .spec
