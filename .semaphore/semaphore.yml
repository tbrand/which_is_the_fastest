---
version: v1.0
name: Benchmarking suite
execution_time_limit:
  hours: 3
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
- name: setup
  dependencies: []
  task:
    jobs:
    - name: setup
      commands:
      - checkout
      - cache store $SEMAPHORE_GIT_SHA .
      - sudo snap install crystal --classic
      - sudo apt-get -y install libyaml-dev libevent-dev
      - shards build --static
      - cache store bin bin
      - bundle config path .cache
      - bundle install
      - cache store built-in .cache
      - bundle exec rake config
- name: python
  dependencies:
  - setup
  task:
    prologue:
      commands:
      - cache restore $SEMAPHORE_GIT_SHA
      - cache restore bin
      - cache restore built-in
      - find bin -type f -exec chmod +x {} \;
      - bundle config path .cache
      - bundle install
      - bundle exec rake config
    jobs:
    - name: flask
      commands:
      - cd python/flask && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/flask bundle exec rspec .spec
    - name: aiohttp
      commands:
      - cd python/aiohttp && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/aiohttp bundle exec rspec .spec
    - name: apidaora
      commands:
      - cd python/apidaora && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/apidaora bundle exec rspec .spec
    - name: masonite
      commands:
      - cd python/masonite && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/masonite bundle exec rspec .spec
    - name: clastic
      commands:
      - cd python/clastic && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/clastic bundle exec rspec .spec
    - name: index.py
      commands:
      - cd python/index.py && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/index.py bundle exec rspec .spec
    - name: quart
      commands:
      - cd python/quart && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/quart bundle exec rspec .spec
    - name: pyramid
      commands:
      - cd python/pyramid && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/pyramid bundle exec rspec .spec
    - name: starlette
      commands:
      - cd python/starlette && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/starlette bundle exec rspec .spec
    - name: cherrypy
      commands:
      - cd python/cherrypy && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/cherrypy bundle exec rspec .spec
    - name: emmett
      commands:
      - cd python/emmett && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/emmett bundle exec rspec .spec
    - name: hug
      commands:
      - cd python/hug && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/hug bundle exec rspec .spec
    - name: blacksheep
      commands:
      - cd python/blacksheep && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/blacksheep bundle exec rspec .spec
    - name: molten
      commands:
      - cd python/molten && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/molten bundle exec rspec .spec
    - name: tornado
      commands:
      - cd python/tornado && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/tornado bundle exec rspec .spec
    - name: tonberry
      commands:
      - cd python/tonberry && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/tonberry bundle exec rspec .spec
    - name: nameko
      commands:
      - cd python/nameko && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/nameko bundle exec rspec .spec
    - name: fastapi
      commands:
      - cd python/fastapi && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/fastapi bundle exec rspec .spec
    - name: klein
      commands:
      - cd python/klein && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/klein bundle exec rspec .spec
    - name: sanic
      commands:
      - cd python/sanic && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/sanic bundle exec rspec .spec
    - name: responder
      commands:
      - cd python/responder && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/responder bundle exec rspec .spec
    - name: asgineer
      commands:
      - cd python/asgineer && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/asgineer bundle exec rspec .spec
    - name: django-ninja
      commands:
      - cd python/django-ninja && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/django-ninja bundle exec rspec .spec
    - name: cyclone
      commands:
      - cd python/cyclone && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/cyclone bundle exec rspec .spec
    - name: django
      commands:
      - cd python/django && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/django bundle exec rspec .spec
    - name: falcon
      commands:
      - cd python/falcon && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/falcon bundle exec rspec .spec
    - name: bottle
      commands:
      - cd python/bottle && make build  -f .Makefile  && cd -
      - FRAMEWORK=python/bottle bundle exec rspec .spec
